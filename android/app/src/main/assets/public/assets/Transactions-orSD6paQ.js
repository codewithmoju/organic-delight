var e=(e,t,a)=>new Promise((s,i)=>{var r=e=>{try{l(a.next(e))}catch(t){i(t)}},n=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,n);l((a=a.apply(e,t)).next())});import{j as t,m as a,P as s,h as i,o as r,a3 as n,W as l,c,y as o,z as d,D as m,U as x}from"./ui-vendor-xs3J0kw7.js";import{r as u}from"./react-vendor-BVrHFBWf.js";import{u as p,f as y}from"./utils-vendor-DglL0U6P.js";import{a as h,c as j}from"./transactions-Dil5G5Bn.js";import{getItemStockLevel as b,getItems as g}from"./items-jQwjfGOh.js";import{u as f,g as v,P as N}from"./PaginationControls-DhISIAKu.js";import{b as w}from"./index-CKK7GlfE.js";import{f as k}from"./notifications-tOheaLyS.js";import{A as _}from"./AnimatedCard-D-urSkxU.js";import{C as S}from"./ContextualLoader-DUjmIhSg.js";import"./capacitor-vendor-Be0kW8mJ.js";import"./firebase-vendor-Xl_GeJX1.js";import"./debounce-DcMPylXs.js";import"./router-vendor-DDng8bu2.js";function C({items:l,categories:c,onComplete:o,onCancel:d,onSubmit:m}){var x;const[y,h]=u.useState(!1),[j,g]=u.useState(""),[f,v]=u.useState(null),[N,_]=u.useState("stock_in"),[S,C]=u.useState(0),[T,P]=u.useState(0),[D,q]=u.useState({}),F=j?l.filter(e=>e.category_id===j):l;u.useEffect(()=>{f&&I()},[f]);const I=()=>e(this,null,function*(){if(f)try{const e=yield b(f.id);P((null==e?void 0:e.current_quantity)||0)}catch(e){P(0)}}),H=S*((null==f?void 0:f.unit_price)||0);return t.jsxs("form",{onSubmit:function(t){return e(this,null,function*(){t.preventDefault(),q({}),h(!0);try{const e=new FormData(t.currentTarget),a=e.get("supplier_customer").trim(),s=e.get("reference_number").trim(),i=e.get("notes").trim(),r=new Date(e.get("transaction_date")),n={};if(f||(n.item_id="Please select an item"),(!S||S<=0)&&(n.quantity="Quantity must be greater than 0"),"stock_out"===N&&S>T&&(n.quantity=`Insufficient stock. Available: ${T}`),a||(n.supplier_customer=("stock_in"===N?"Supplier":"Customer")+" name is required"),r>new Date&&(n.transaction_date="Transaction date cannot be in the future"),Object.keys(n).length>0)return void q(n);yield m({item_id:f.id,type:N,quantity:S,unit_price:f.unit_price||0,transaction_date:r,supplier_customer:a,reference_number:s||void 0,notes:i||void 0,created_by:"current-user"}),p.success("Transaction recorded successfully"),o()}catch(e){e.message.includes("Insufficient stock")?q({quantity:e.message}):p.error("Failed to record transaction")}finally{h(!1)}})},className:"space-y-6 sm:space-y-8",children:[t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[t.jsx("label",{className:"block text-base font-medium text-gray-300 mb-4",children:"Transaction Type *"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs(a.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>_("stock_in"),className:"p-4 rounded-xl border-2 transition-all duration-200 "+("stock_in"===N?"border-success-500 bg-success-500/10 text-success-400":"border-dark-600 bg-dark-700/30 text-gray-400 hover:border-success-500/50"),children:[t.jsx(s,{className:"w-6 h-6 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold",children:"Stock In"}),t.jsx("div",{className:"text-sm opacity-75",children:"Add inventory"})]}),t.jsxs(a.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>_("stock_out"),className:"p-4 rounded-xl border-2 transition-all duration-200 "+("stock_out"===N?"border-error-500 bg-error-500/10 text-error-400":"border-dark-600 bg-dark-700/30 text-gray-400 hover:border-error-500/50"),children:[t.jsx(s,{className:"w-6 h-6 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold",children:"Stock Out"}),t.jsx("div",{className:"text-sm opacity-75",children:"Remove inventory"})]})]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[t.jsx("label",{htmlFor:"category",className:"block text-base font-medium text-gray-300 mb-3",children:"Select Category *"}),t.jsxs("select",{id:"category",value:j,onChange:e=>{return t=e.target.value,g(t),void v(null);var t},className:"w-full input-dark input-large",children:[t.jsx("option",{value:"",children:"Choose a category first"}),c.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[t.jsx("label",{htmlFor:"item_id",className:"block text-base font-medium text-gray-300 mb-3",children:"Select Product *"}),t.jsxs("select",{id:"item_id",value:(null==f?void 0:f.id)||"",onChange:e=>(e=>{const t=l.find(t=>t.id===e);v(t||null)})(e.target.value),disabled:!j,className:`w-full input-dark input-large ${D.item_id?"ring-error-500 border-error-500":""} ${j?"":"opacity-50 cursor-not-allowed"}`,children:[t.jsx("option",{value:"",children:j?"Choose a product":"Select category first"}),F.map(e=>t.jsxs("option",{value:e.id,children:[e.name," - Current Stock: ",e.current_quantity||0]},e.id))]}),D.item_id&&t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-2 flex items-center text-sm text-error-400",children:[t.jsx(i,{className:"h-4 w-4 mr-1"}),D.item_id]})]}),f&&t.jsxs(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-dark-800/30 border border-dark-700/50 rounded-xl p-4",children:[t.jsxs("h4",{className:"text-white font-semibold mb-2 flex items-center",children:[t.jsx(s,{className:"w-5 h-5 mr-2 text-primary-400"}),f.name]}),t.jsx("p",{className:"text-gray-400 text-sm mb-3",children:f.description}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Current Stock:"}),t.jsx("div",{className:"font-semibold text-lg "+(0===T?"text-error-400":T<10?"text-warning-400":"text-success-400"),children:T})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Unit Price:"}),t.jsx("div",{className:"text-primary-400 font-semibold text-lg",children:k(f.unit_price||0)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Category:"}),t.jsx("div",{className:"text-white font-medium",children:(null==(x=f.category)?void 0:x.name)||"Uncategorized"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"SKU:"}),t.jsx("div",{className:"text-white font-mono text-sm",children:f.sku||"N/A"})]})]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[t.jsx("label",{htmlFor:"quantity",className:"block text-base font-medium text-gray-300 mb-3",children:"Quantity *"}),t.jsx("input",{type:"number",id:"quantity",min:"0.01",step:"0.01",value:S||"",onChange:e=>C(parseFloat(e.target.value)||0),disabled:!f,className:`w-full input-dark input-large ${D.quantity?"ring-error-500 border-error-500":""} ${f?"":"opacity-50 cursor-not-allowed"}`,placeholder:"Enter quantity"}),D.quantity&&t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-2 flex items-center text-sm text-error-400",children:[t.jsx(i,{className:"h-4 w-4 mr-1"}),D.quantity]}),"stock_out"===N&&f&&S>T&&t.jsxs("div",{className:"mt-2 flex items-center text-sm text-warning-400",children:[t.jsx(i,{className:"h-4 w-4 mr-1"}),"Warning: Quantity exceeds available stock (",T,")"]})]}),f&&t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[t.jsx("label",{className:"block text-base font-medium text-gray-300 mb-3",children:"Unit Price (Fixed)"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:k(f.unit_price||0),readOnly:!0,className:"w-full input-dark input-large bg-dark-800/50 cursor-not-allowed pr-10"}),t.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:t.jsx(r,{className:"w-5 h-5 text-gray-500"})})]}),t.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Price is automatically set from product definition and cannot be modified"})]}),f&&S>0&&t.jsxs(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-primary-500/10 to-accent-500/10 border border-primary-500/20 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(n,{className:"w-5 h-5 text-primary-400 mr-3"}),t.jsx("span",{className:"text-gray-300 font-medium",children:"Total Transaction Value:"})]}),t.jsx("span",{className:"text-2xl font-bold text-primary-400",children:k(H)})]}),t.jsxs("div",{className:"mt-2 text-sm text-gray-400 text-center",children:[S," Ã— ",k(f.unit_price||0)," = ",k(H)]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[t.jsx("label",{htmlFor:"transaction_date",className:"block text-base font-medium text-gray-300 mb-3",children:"Transaction Date *"}),t.jsx("input",{type:"datetime-local",name:"transaction_date",id:"transaction_date",defaultValue:(new Date).toISOString().slice(0,16),required:!0,className:"w-full input-dark input-large "+(D.transaction_date?"ring-error-500 border-error-500":"")}),D.transaction_date&&t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-2 flex items-center text-sm text-error-400",children:[t.jsx(i,{className:"h-4 w-4 mr-1"}),D.transaction_date]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:[t.jsxs("label",{htmlFor:"supplier_customer",className:"block text-base font-medium text-gray-300 mb-3",children:["stock_in"===N?"Supplier":"Customer"," *"]}),t.jsx("input",{type:"text",name:"supplier_customer",id:"supplier_customer",required:!0,maxLength:200,className:"w-full input-dark input-large "+(D.supplier_customer?"ring-error-500 border-error-500":""),placeholder:`Enter ${"stock_in"===N?"supplier":"customer"} name`}),D.supplier_customer&&t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-2 flex items-center text-sm text-error-400",children:[t.jsx(i,{className:"h-4 w-4 mr-1"}),D.supplier_customer]})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:[t.jsx("label",{htmlFor:"reference_number",className:"block text-base font-medium text-gray-300 mb-3",children:"Reference Number (Optional)"}),t.jsx("input",{type:"text",name:"reference_number",id:"reference_number",maxLength:100,className:"w-full input-dark input-large",placeholder:"Enter invoice/receipt number"})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},children:[t.jsx("label",{htmlFor:"notes",className:"block text-base font-medium text-gray-300 mb-3",children:"Notes (Optional)"}),t.jsx("textarea",{name:"notes",id:"notes",rows:3,maxLength:1e3,className:"w-full input-dark input-large resize-none",placeholder:"Add any additional notes about this transaction..."})]}),t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 pt-6 sm:pt-8 border-t border-dark-700/50",children:[t.jsx(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:d,className:"btn-secondary px-6 sm:px-8 py-3 text-base sm:text-lg order-2 sm:order-1",children:"Cancel"}),t.jsx(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:y||!f||S<=0,className:"btn-primary flex items-center gap-2 min-w-[180px] px-6 sm:px-8 py-3 text-base sm:text-lg order-1 sm:order-2",children:y?t.jsxs(t.Fragment,{children:[t.jsx(w,{size:"sm",color:"white"}),"Recording..."]}):"Record Transaction"})]})]})}function T(){const[i,r]=u.useState([]),[n,b]=u.useState([]),[w,T]=u.useState([]),[P,D]=u.useState([]),[q,F]=u.useState(!1),[I,H]=u.useState(!0),[A,R]=u.useState("all"),[L,O]=u.useState("all"),E=f({data:n,defaultItemsPerPage:25});function U(){return e(this,null,function*(){try{const[e,t,a]=yield Promise.all([h(),g(),v()]);r(e.transactions||e),T(t.items||t),D(a)}catch(e){p.error("Failed to load transactions")}finally{H(!1)}})}return u.useEffect(()=>{U()},[]),u.useEffect(()=>{!function(){let e=i;"all"!==A&&(e=e.filter(e=>e.type===A));if("all"!==L){const t=new Date,a=new Date;switch(L){case"today":a.setHours(0,0,0,0);break;case"week":a.setDate(t.getDate()-7);break;case"month":a.setMonth(t.getMonth()-1)}e=e.filter(e=>new Date(e.transaction_date.toDate?e.transaction_date.toDate():e.transaction_date)>=a)}b(e)}()},[i,A,L]),q?t.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"New Transaction"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Record a new inventory transaction"})]}),t.jsx(_,{children:t.jsx("div",{className:"p-6",children:t.jsx(C,{items:w,categories:P,onSubmit:function(t){return e(this,null,function*(){try{yield j(t),yield U()}catch(e){throw e}})},onComplete:()=>{F(!1),U()},onCancel:()=>F(!1)})})})]}):t.jsxs("div",{className:"relative",children:[t.jsx(S,{isLoading:I,context:"transactions",variant:"overlay"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(a.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gradient",children:"Transactions"}),t.jsx("p",{className:"text-gray-400 mt-1 text-sm sm:text-base",children:"Record and track all inventory movements"})]}),t.jsxs(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:()=>F(!0),className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[t.jsx(l,{className:"h-4 w-4"}),"New Transaction"]})]}),t.jsx(_,{delay:.1,children:t.jsx("div",{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Transaction Type"}),t.jsxs("select",{value:A,onChange:e=>R(e.target.value),className:"w-full input-dark",children:[t.jsx("option",{value:"all",children:"All Transactions"}),t.jsx("option",{value:"stock_in",children:"Stock In"}),t.jsx("option",{value:"stock_out",children:"Stock Out"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Date Range"}),t.jsxs("select",{value:L,onChange:e=>O(e.target.value),className:"w-full input-dark",children:[t.jsx("option",{value:"all",children:"All Time"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"week",children:"Last 7 Days"}),t.jsx("option",{value:"month",children:"Last 30 Days"})]})]})]})})}),t.jsxs(_,{delay:.2,children:[t.jsx("div",{className:"p-4 sm:p-6","data-tour":"transactions-list",children:t.jsx("div",{className:"space-y-4",children:t.jsx(c,{children:0===E.paginatedData.length?t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 sm:py-16 px-4",children:[t.jsx(s,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-400 mb-2",children:"No transactions found"}),t.jsx("p",{className:"text-gray-500 mb-6 text-sm sm:text-base",children:"all"!==A||"all"!==L?"Try adjusting your filter criteria":"Start by recording your first transaction"}),"all"===A&&"all"===L&&t.jsxs(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>F(!0),className:"btn-primary",children:[t.jsx(l,{className:"w-4 h-4 mr-2"}),"Record First Transaction"]})]}):E.paginatedData.map((e,s)=>{var i;return t.jsxs(a.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.05*s},whileHover:{scale:1.02,x:4},className:"flex items-center justify-between p-4 sm:p-6 rounded-xl bg-dark-800/30 border border-dark-700/30 hover:border-primary-500/30 transition-all duration-200",children:[t.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[t.jsx("div",{className:"p-3 rounded-xl flex-shrink-0 "+("stock_in"===e.type?"bg-success-500/20 text-success-400":"bg-error-500/20 text-error-400"),children:"stock_in"===e.type?t.jsx(o,{className:"w-6 h-6"}):t.jsx(d,{className:"w-6 h-6"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h4",{className:"text-white font-semibold text-lg truncate",children:(null==(i=e.item)?void 0:i.name)||"Unknown Item"}),t.jsxs("div",{className:"flex items-center text-sm text-gray-400 mt-1",children:[t.jsx(m,{className:"w-4 h-4 mr-1"}),y(new Date(e.transaction_date.toDate?e.transaction_date.toDate():e.transaction_date),"MMM d, yyyy HH:mm")]}),t.jsxs("div",{className:"flex items-center text-sm text-gray-400 mt-1",children:[t.jsx(x,{className:"w-4 h-4 mr-1"}),e.supplier_customer]})]})]}),t.jsxs("div",{className:"text-right flex-shrink-0",children:[t.jsxs("div",{className:"text-xl font-bold "+("stock_in"===e.type?"text-success-400":"text-error-400"),children:["stock_in"===e.type?"+":"-",e.quantity]}),t.jsxs("div",{className:"text-sm text-gray-400",children:["@ ",k(e.unit_price)]}),t.jsx("div",{className:"text-lg font-semibold text-primary-400 mt-1",children:k(e.total_value)}),e.reference_number&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Ref: ",e.reference_number]})]})]},e.id)})})})}),n.length>0&&t.jsx("div",{className:"p-4 sm:p-6 border-t border-dark-700/50",children:t.jsx(N,{currentPage:E.currentPage,totalPages:E.totalPages,onPageChange:E.goToPage,hasNextPage:E.hasNextPage,hasPrevPage:E.hasPrevPage,startIndex:E.startIndex,endIndex:E.endIndex,totalItems:E.totalItems})})]})]})]})}export{T as default};

var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,d=(t,e)=>{for(var a in e||(e={}))n.call(e,a)&&o(t,a,e[a]);if(r)for(var a of r(e))i.call(e,a)&&o(t,a,e[a]);return t},c=(t,r)=>e(t,a(r)),s=(t,e,a)=>new Promise((r,n)=>{var i=t=>{try{d(a.next(t))}catch(e){n(e)}},o=t=>{try{d(a.throw(t))}catch(e){n(e)}},d=t=>t.done?r(t.value):Promise.resolve(t.value).then(i,o);d((a=a.apply(t,e)).next())});import{m as u,q as l,w as p,n as _,v as m,d as y,T as f}from"./firebase-vendor-Xl_GeJX1.js";import{d as w}from"./index-CKK7GlfE.js";function D(t,e){return s(this,null,function*(){return yield m(w,a=>s(this,null,function*(){const r=u(w,"items"),n=l(r,p("category_id","==",t.category_id),p("name","==",t.name.trim()));if(!(yield a.get(n)).empty)throw new Error("An item with this name already exists in this category");if(t.barcode){const e=l(r,p("barcode","==",t.barcode));if(!(yield a.get(e)).empty)throw new Error("An item with this barcode already exists")}if(t.sku){const e=l(r,p("sku","==",t.sku));if(!(yield a.get(e)).empty)throw new Error("An item with this SKU already exists")}const i=y(u(w,"items")),o=c(d({},t),{name:t.name.trim(),is_archived:!1,created_at:f.fromDate(new Date),updated_at:f.fromDate(new Date)});if(a.set(i,o),e>0){const r=y(u(w,"transactions"));a.set(r,{item_id:i.id,type:"stock_in",quantity:e,unit_price:t.unit_price,total_value:e*t.unit_price,transaction_date:f.fromDate(new Date),supplier_customer:t.supplier||"Initial Stock",reference_number:`INIT-${i.id.slice(-6).toUpperCase()}`,notes:"Initial stock entry during product creation",created_by:t.created_by,created_at:f.fromDate(new Date)})}return c(d({id:i.id},o),{created_at:new Date,updated_at:new Date})}))})}function h(t){return s(this,null,function*(){var e,a;try{const r=u(w,"items"),n=l(r,p("barcode","==",t),p("is_archived","!=",!0)),i=yield _(n);if(i.empty)return null;const o=i.docs[0],s=o.data();return c(d({id:o.id},s),{created_at:(null==(e=s.created_at)?void 0:e.toDate)?s.created_at.toDate():new Date(s.created_at||Date.now()),updated_at:(null==(a=s.updated_at)?void 0:a.toDate)?s.updated_at.toDate():new Date(s.updated_at||Date.now())})}catch(r){return null}})}function b(t){return s(this,null,function*(){var e,a;try{const r=u(w,"items"),n=l(r,p("sku","==",t),p("is_archived","!=",!0)),i=yield _(n);if(i.empty)return null;const o=i.docs[0],s=o.data();return c(d({id:o.id},s),{created_at:(null==(e=s.created_at)?void 0:e.toDate)?s.created_at.toDate():new Date(s.created_at||Date.now()),updated_at:(null==(a=s.updated_at)?void 0:a.toDate)?s.updated_at.toDate():new Date(s.updated_at||Date.now())})}catch(r){return null}})}export{b as a,D as c,h as g};

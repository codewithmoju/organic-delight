const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/items-jQwjfGOh.js","assets/firebase-vendor-Xl_GeJX1.js","assets/index-CKK7GlfE.js","assets/ui-vendor-xs3J0kw7.js","assets/react-vendor-BVrHFBWf.js","assets/capacitor-vendor-Be0kW8mJ.js","assets/router-vendor-DDng8bu2.js","assets/utils-vendor-DglL0U6P.js","assets/index-CXWmK9jD.css"])))=>i.map(i=>d[i]);
var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(e,a,n)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,s=(t,e)=>{for(var a in e||(e={}))r.call(e,a)&&o(t,a,e[a]);if(n)for(var a of n(e))i.call(e,a)&&o(t,a,e[a]);return t},c=(t,n)=>e(t,a(n)),d=(t,e,a)=>new Promise((n,r)=>{var i=t=>{try{s(a.next(t))}catch(e){r(e)}},o=t=>{try{s(a.throw(t))}catch(e){r(e)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(i,o);s((a=a.apply(t,e)).next())});import{_ as l}from"./capacitor-vendor-Be0kW8mJ.js";import{m as u,q as m,r as _,t as f,n as p,b as y,d as w,x as v,T as D}from"./firebase-vendor-Xl_GeJX1.js";import{d as b}from"./index-CKK7GlfE.js";const g=new Map;function h(t){return Date.now()-t<6e4}function j(t,e){return d(this,null,function*(){var e,a;const n=`transactions-${t||"all"}-start`,r=g.get(n);if(r&&h(r.timestamp))return r.data;const i=u(b,"transactions");let o=m(i,_("transaction_date","desc"));t&&(o=m(o,f(t)));const d=yield p(o),l=[];for(const t of d.docs){const n=t.data(),r=c(s({id:t.id},n),{transaction_date:(null==(e=n.transaction_date)?void 0:e.toDate)?n.transaction_date.toDate():new Date(n.transaction_date||Date.now()),created_at:(null==(a=n.created_at)?void 0:a.toDate)?n.created_at.toDate():new Date(n.created_at||Date.now())});if(r.item_id){const t=yield y(w(b,"items",r.item_id));if(t.exists()&&(r.item=s({id:t.id},t.data()),r.item.category_id)){const t=yield y(w(b,"categories",r.item.category_id));t.exists()&&(r.item.category=s({id:t.id},t.data()))}}l.push(r)}const v={transactions:l,lastDoc:d.docs[d.docs.length-1]};return g.set(n,{data:v,timestamp:Date.now()}),v})}function O(t=5){return d(this,null,function*(){const e=`recent-transactions-${t}`,a=g.get(e);if(a&&h(a.timestamp))return a.data;const n=(yield j(t)).transactions;return g.set(e,{data:n,timestamp:Date.now()}),n})}function x(t){return d(this,null,function*(){const e=t.quantity*t.unit_price;if("stock_out"===t.type){const e=yield l(()=>import("./items-jQwjfGOh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>e.getItemStockLevel(t.item_id));if(e&&t.quantity>e.current_quantity)throw new Error(`Insufficient stock. Available: ${e.current_quantity}`)}const a=yield v(u(b,"transactions"),c(s({},t),{total_value:e,transaction_date:D.fromDate(t.transaction_date),created_at:new Date})),n=c(s({id:a.id},t),{transaction_date:t.transaction_date,created_at:new Date,total_value:e}),r=yield y(w(b,"items",t.item_id));return r.exists()&&(n.item=s({id:r.id},r.data())),n})}export{j as a,x as c,O as g};

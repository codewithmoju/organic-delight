const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/items-jQwjfGOh.js","assets/firebase-vendor-Xl_GeJX1.js","assets/index-CKK7GlfE.js","assets/ui-vendor-xs3J0kw7.js","assets/react-vendor-BVrHFBWf.js","assets/capacitor-vendor-Be0kW8mJ.js","assets/router-vendor-DDng8bu2.js","assets/utils-vendor-DglL0U6P.js","assets/index-CXWmK9jD.css"])))=>i.map(i=>d[i]);
var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(e,a,o)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,s=(t,s)=>{for(var r in s||(s={}))a.call(s,r)&&n(t,r,s[r]);if(e)for(var r of e(s))o.call(s,r)&&n(t,r,s[r]);return t},r=(t,e,a)=>new Promise((o,n)=>{var s=t=>{try{c(a.next(t))}catch(e){n(e)}},r=t=>{try{c(a.throw(t))}catch(e){n(e)}},c=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);c((a=a.apply(t,e)).next())});import{_ as c}from"./capacitor-vendor-Be0kW8mJ.js";import{m as i,q as u,r as d,w as l,T as m,n as h}from"./firebase-vendor-Xl_GeJX1.js";import{d as p}from"./index-CKK7GlfE.js";function f(t){const e=new Date,a=new Date,o=new Date;switch(t){case"today":default:a.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"this-week":const t=e.getDay(),n=0===t?6:t-1;a.setDate(e.getDate()-n),a.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"this-month":a.setDate(1),a.setHours(0,0,0,0),o.setMonth(e.getMonth()+1,0),o.setHours(23,59,59,999);break;case"previous-month":a.setMonth(e.getMonth()-1,1),a.setHours(0,0,0,0),o.setMonth(e.getMonth(),0),o.setHours(23,59,59,999);break;case"last-3-months":a.setMonth(e.getMonth()-3),a.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"last-6-months":a.setMonth(e.getMonth()-6),a.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"this-year":a.setMonth(0,1),a.setHours(0,0,0,0),o.setMonth(11,31),o.setHours(23,59,59,999)}return{start:a,end:o}}const v=new Map;function y(t){return Date.now()-t<3e5}function k(t){return r(this,null,function*(){const e=function(t){return`dashboard-metrics-${t}`}(t),a=v.get(e);if(a&&y(a.timestamp))return a.data;const{start:o,end:n}=f(t),s=i(p,"transactions"),r=u(s,l("transaction_date",">=",m.fromDate(o)),l("transaction_date","<=",m.fromDate(n)),d("transaction_date","desc")),c=yield h(r);let k=0,_=0,D=0,b=0;c.docs.forEach(t=>{const e=t.data();"stock_in"===e.type?(k+=e.quantity,D+=e.total_value):"stock_out"===e.type&&(_+=e.quantity,b+=e.total_value)});const w={totalStockIn:k,totalStockOut:_,revenueSpentOnStockIn:D,revenueEarnedFromStockOut:b};return v.set(e,{data:w,timestamp:Date.now()}),w})}function _(t){return r(this,null,function*(){const e=`inventory-trends-${t}`,a=v.get(e);if(a&&y(a.timestamp))return a.data;const{start:o,end:n}=f(t),s=i(p,"transactions"),r=u(s,l("transaction_date",">=",m.fromDate(o)),l("transaction_date","<=",m.fromDate(n)),d("transaction_date","desc")),c=yield h(r),k={};c.docs.forEach(e=>{var a;const o=e.data(),n=(null==(a=o.transaction_date)?void 0:a.toDate)?o.transaction_date.toDate():new Date(o.transaction_date||Date.now());let s;switch(t){case"today":s=n.getHours().toString().padStart(2,"0")+":00";break;case"this-week":s=n.toLocaleDateString("en-US",{weekday:"short"});break;case"this-month":case"previous-month":s=`${n.getDate()}`;break;default:s=n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}k[s]||(k[s]={period:s,stockIn:0,stockOut:0,revenueIn:0,revenueOut:0}),"stock_in"===o.type?(k[s].stockIn+=o.quantity,k[s].revenueIn+=o.total_value):(k[s].stockOut+=o.quantity,k[s].revenueOut+=o.total_value)});const _=Object.values(k);return v.set(e,{data:_,timestamp:Date.now()}),_})}function D(){return r(this,null,function*(){const t="stock-levels",e=v.get(t);if(e&&y(e.timestamp))return e.data;const a=i(p,"items"),o=yield h(a),n=[];for(const i of o.docs){const t=s({id:i.id},i.data()),e=yield c(()=>import("./items-jQwjfGOh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>e.getItemStockLevel(t.id));e&&(e.item=t,n.push(e))}const r=n.sort((t,e)=>e.total_value-t.total_value);return v.set(t,{data:r,timestamp:Date.now()}),r})}export{_ as a,D as b,k as g};

import{j as e,m as t}from"./ui-vendor-xs3J0kw7.js";import{r as s}from"./react-vendor-BVrHFBWf.js";import{u as a}from"./utils-vendor-DglL0U6P.js";import{a as r}from"./transactions-Dil5G5Bn.js";import{getItems as i}from"./items-jQwjfGOh.js";import{A as n}from"./AnimatedCard-D-urSkxU.js";import{f as l}from"./notifications-tOheaLyS.js";import{C as o}from"./ContextualLoader-DUjmIhSg.js";import{u as d}from"./index-CKK7GlfE.js";import{R as c,B as m,C as x,X as u,Y as p,T as h,a as j,P as f,c as y,d as v}from"./chart-vendor-BwNApLFi.js";import"./capacitor-vendor-Be0kW8mJ.js";import"./firebase-vendor-Xl_GeJX1.js";import"./router-vendor-DDng8bu2.js";function g(){const{t:g}=d(),[b,N]=s.useState([]),[w,k]=s.useState([]),[_,q]=s.useState([]),[C,S]=s.useState(!0),A=["#3b82f6","#d946ef","#10b981","#f59e0b","#ef4444","#8b5cf6"];s.useEffect(()=>{!function(){return e=this,t=null,s=function*(){try{const[e,t]=yield Promise.all([r(),i()]),s=e.transactions||e,a=t.items||t,n=s.reduce((e,t)=>{var s;const a=((null==(s=t.created_at)?void 0:s.toDate)?t.created_at.toDate():new Date(t.created_at)).toLocaleString("default",{month:"short"}),r="out"===t.type?Math.abs(t.quantity_changed):0;return e[a]||(e[a]={name:a,value:0,revenue:0}),e[a].value+=r,e[a].revenue+=r*(t.cost_per_unit||0),e},{}),l=s.reduce((e,t)=>{if("out"===t.type&&t.item){const{name:s}=t.item;e[s]||(e[s]={name:s,quantity:0,revenue:0}),e[s].quantity+=Math.abs(t.quantity_changed),e[s].revenue+=Math.abs(t.quantity_changed)*(t.cost_per_unit||0)}return e},{}),o=a.reduce((e,t)=>{var s;const a=(null==(s=t.category)?void 0:s.name)||"Uncategorized";return e[a]||(e[a]={name:a,value:0,count:0}),e[a].value+=t.quantity*t.unit_price,e[a].count+=1,e},{});N(Object.values(n)),k(Object.values(l).sort((e,t)=>t.quantity-e.quantity).slice(0,5)),q(Object.values(o))}catch(e){a.error("Failed to load report data")}finally{S(!1)}},new Promise((a,r)=>{var i=e=>{try{l(s.next(e))}catch(t){r(t)}},n=e=>{try{l(s.throw(e))}catch(t){r(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);l((s=s.apply(e,t)).next())});var e,t,s}()},[]);const D=({active:t,payload:s,label:a})=>t&&s&&s.length?e.jsxs("div",{className:"glass-effect p-3 rounded-lg border border-dark-600/50",children:[e.jsx("p",{className:"text-gray-200 font-medium",children:a}),s.map((t,s)=>e.jsxs("p",{className:"text-primary-400",children:[t.name,": ",t.value]},s))]}):null;return e.jsxs("div",{className:"relative",children:[e.jsx(o,{isLoading:C,context:"reports",variant:"overlay"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(t.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gradient mb-2",children:g("reports.title")}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:g("reports.subtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 lg:gap-8","data-tour":"reports-charts",children:[e.jsx(n,{delay:.1,children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6 flex items-center",children:[e.jsx("div",{className:"w-2 h-6 bg-gradient-to-b from-primary-500 to-accent-500 rounded-full mr-3"}),"Monthly Transaction Volume"]}),e.jsx("div",{className:"h-64 sm:h-80 w-full",children:e.jsx(c,{width:"100%",height:"100%",children:e.jsxs(m,{data:b,children:[e.jsx(x,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),e.jsx(u,{dataKey:"name",stroke:"#9CA3AF",fontSize:10}),e.jsx(p,{stroke:"#9CA3AF",fontSize:10}),e.jsx(h,{content:e.jsx(D,{})}),e.jsx(j,{dataKey:"value",fill:"url(#colorGradient)",radius:[4,4,0,0]}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"100%",stopColor:"#d946ef"})]})})]})})})]})}),e.jsx(n,{delay:.2,children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6 flex items-center",children:[e.jsx("div",{className:"w-2 h-6 bg-gradient-to-b from-success-500 to-warning-500 rounded-full mr-3"}),"Category Distribution"]}),e.jsx("div",{className:"h-64 sm:h-80 w-full",children:e.jsx(c,{width:"100%",height:"100%",children:e.jsxs(f,{children:[e.jsx(y,{data:_,cx:"50%",cy:"50%",outerRadius:"80%",fill:"#8884d8",dataKey:"value",label:({name:e,percent:t})=>`${e} ${(100*t).toFixed(0)}%`,children:_.map((t,s)=>e.jsx(v,{fill:A[s%A.length]},`cell-${s}`))}),e.jsx(h,{content:e.jsx(D,{})})]})})})]})})]}),e.jsx(n,{delay:.3,children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6 flex items-center",children:[e.jsx("div",{className:"w-2 h-6 bg-gradient-to-b from-warning-500 to-error-500 rounded-full mr-3"}),"Top Performing Items"]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-dark-700/50",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-dark-700/50",children:[e.jsx("thead",{className:"bg-dark-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Quantity Sold"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Revenue"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-700/30",children:w.map((s,a)=>e.jsxs(t.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*a},className:"hover:bg-dark-700/30 transition-colors duration-200",children:[e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 text-sm font-medium text-white",children:e.jsx("div",{className:"truncate max-w-[150px] sm:max-w-none",children:s.name})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-300",children:s.quantity}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-primary-400 font-semibold",children:l(s.revenue)})]},s.name))})]})})]})})]})]})}export{g as default};
